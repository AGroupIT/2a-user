# üì± –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ Push-–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º –≤ 2A Logistic

## –û–±–∑–æ—Ä –°–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ 2A Logistic –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω—É—é –¥–æ—Å—Ç–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–∞–º –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –Ω–∞ –≤—Å–µ—Ö –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö.

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã

- ‚úÖ **iOS** - —á–µ—Ä–µ–∑ Apple Push Notification Service (APNs) via Firebase
- ‚úÖ **Android** - —á–µ—Ä–µ–∑ Firebase Cloud Messaging (FCM)
- ‚úÖ **Web** - —á–µ—Ä–µ–∑ Web Push API + Service Workers
- ‚úÖ **macOS** - —á–µ—Ä–µ–∑ flutter_local_notifications
- ‚úÖ **Windows** - —á–µ—Ä–µ–∑ flutter_local_notifications

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  2a-user        ‚îÇ  (–ö–ª–∏–µ–Ω—Ç—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
‚îÇ  FCM Project:   ‚îÇ
‚îÇ  a-user         ‚îÇ
‚îÇ  ID: 949693718080‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Firebase       ‚îÇ
‚îÇ  Cloud          ‚îÇ
‚îÇ  Messaging      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Next.js        ‚îÇ
‚îÇ  Backend        ‚îÇ
‚îÇ  (notifications.‚îÇ
‚îÇ   ts)           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PostgreSQL     ‚îÇ
‚îÇ  (Prisma)       ‚îÇ
‚îÇ  - Notification ‚îÇ
‚îÇ  - DeviceToken  ‚îÇ
‚îÇ  - PushDelivery ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –¢–∏–ø—ã –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è –ö–ª–∏–µ–Ω—Ç–æ–≤

### 1. –¢—Ä–µ–∫–∏ (Track Notifications)

#### 1.1 –ù–æ–≤—ã–π —Ç—Ä–µ–∫ —Å–æ–∑–¥–∞–Ω
```typescript
NotificationTypes.TRACK_CREATED = 'track_created'
```
**–ö–æ–≥–¥–∞:** –¢—Ä–µ–∫-–Ω–æ–º–µ—Ä –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –∫–æ–¥—É –∫–ª–∏–µ–Ω—Ç–∞
**–ü—Ä–∏–º–µ—Ä:** "üì¶ –ù–æ–≤—ã–π —Ç—Ä–µ–∫ –¥–æ–±–∞–≤–ª–µ–Ω - –¢—Ä–µ–∫-–Ω–æ–º–µ—Ä ABC123 –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –≤–∞—à–µ–º—É –∫–æ–¥—É"

#### 1.2 –°—Ç–∞—Ç—É—Å —Ç—Ä–µ–∫–∞ –∏–∑–º–µ–Ω–µ–Ω
```typescript
NotificationTypes.TRACK_STATUS_CHANGED = 'track_status_changed'
```
**–ö–æ–≥–¥–∞:** –°—Ç–∞—Ç—É—Å —Ç—Ä–µ–∫–∞ –∏–∑–º–µ–Ω–∏–ª—Å—è (–Ω–∞ —Å–∫–ª–∞–¥–µ, –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω, –¥–æ—Å—Ç–∞–≤–ª–µ–Ω –∏ —Ç.–¥.)
**–ü—Ä–∏–º–µ—Ä:** "üì¶ –°—Ç–∞—Ç—É—Å —Ç—Ä–µ–∫–∞ –∏–∑–º–µ–Ω—ë–Ω - –¢—Ä–µ–∫ ABC123 –∏–∑–º–µ–Ω–∏–ª —Å—Ç–∞—Ç—É—Å –Ω–∞ '–ù–∞ —Å–∫–ª–∞–¥–µ'"

#### 1.3 –¢—Ä–µ–∫ –ø—Ä–∏–±—ã–ª –Ω–∞ —Å–∫–ª–∞–¥
```typescript
NotificationTypes.TRACK_ARRIVED_WAREHOUSE = 'track_arrived_warehouse'
```
**–ü—Ä–∏–º–µ—Ä:** "üì¶ –¢—Ä–µ–∫ –ø—Ä–∏–±—ã–ª –Ω–∞ —Å–∫–ª–∞–¥ - ABC123"

#### 1.4 –¢—Ä–µ–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
```typescript
NotificationTypes.TRACK_SHIPPED = 'track_shipped'
```
**–ü—Ä–∏–º–µ—Ä:** "üì¶ –¢—Ä–µ–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω - ABC123"

#### 1.5 –¢—Ä–µ–∫ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω
```typescript
NotificationTypes.TRACK_DELIVERED = 'track_delivered'
```
**–ü—Ä–∏–º–µ—Ä:** "üì¶ –¢—Ä–µ–∫ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω - ABC123"

### 2. –§–æ—Ç–æ–æ—Ç—á–µ—Ç—ã (Photo Reports)

#### 2.1 –§–æ—Ç–æ–æ—Ç—á–µ—Ç –≥–æ—Ç–æ–≤
```typescript
NotificationTypes.PHOTO_REQUEST_COMPLETED = 'photo_request_completed'
```
**–ö–æ–≥–¥–∞:** –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –∑–∞–≥—Ä—É–∑–∏–ª —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
**–ü—Ä–∏–º–µ—Ä:** "üì∏ –§–æ—Ç–æ–æ—Ç—á—ë—Ç –≥–æ—Ç–æ–≤ - –§–æ—Ç–æ–æ—Ç—á—ë—Ç –¥–ª—è —Ç—Ä–µ–∫–∞ ABC123 –≥–æ—Ç–æ–≤"

### 3. –í–æ–ø—Ä–æ—Å—ã (Questions)

#### 3.1 –û—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å –ø–æ–ª—É—á–µ–Ω
```typescript
NotificationTypes.QUESTION_ANSWERED = 'question_answered'
```
**–ö–æ–≥–¥–∞:** –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –æ—Ç–≤–µ—Ç–∏–ª –Ω–∞ –≤–æ–ø—Ä–æ—Å –∫–ª–∏–µ–Ω—Ç–∞
**–ü—Ä–∏–º–µ—Ä:** "üí¨ –û—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å - –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –Ω–∞ –≤–∞—à –≤–æ–ø—Ä–æ—Å –ø–æ —Ç—Ä–µ–∫—É ABC123"

### 4. –°—á–µ—Ç–∞ (Invoices)

#### 4.1 –ù–æ–≤—ã–π —Å—á–µ—Ç —Å–æ–∑–¥–∞–Ω
```typescript
NotificationTypes.INVOICE_CREATED = 'invoice_created'
```
**–ü—Ä–∏–º–µ—Ä:** "üíµ –ù–æ–≤—ã–π —Å—á–µ—Ç - –°—á–µ—Ç #INV-2025-0001 –Ω–∞ —Å—É–º–º—É 15000‚ÇΩ"

#### 4.2 –°—á–µ—Ç –æ–ø–ª–∞—á–µ–Ω
```typescript
NotificationTypes.INVOICE_PAID = 'invoice_paid'
```
**–ü—Ä–∏–º–µ—Ä:** "‚úÖ –°—á–µ—Ç –æ–ø–ª–∞—á–µ–Ω - –°—á–µ—Ç #INV-2025-0001 –æ–ø–ª–∞—á–µ–Ω"

#### 4.3 –°—Ç–∞—Ç—É—Å —Å—á–µ—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω
```typescript
NotificationTypes.INVOICE_STATUS_CHANGED = 'invoice_status_changed'
```
**–ü—Ä–∏–º–µ—Ä:** "üíµ –°—Ç–∞—Ç—É—Å —Å—á–µ—Ç–∞ –∏–∑–º–µ–Ω—ë–Ω - –°—á–µ—Ç #INV-2025-0001"

### 5. –ß–∞—Ç—ã (Chat Messages)

#### 5.1 –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏
```typescript
NotificationTypes.CHAT_MESSAGE = 'chat_message'
```
**–ö–æ–≥–¥–∞:** –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –æ—Ç–ø—Ä–∞–≤–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏
**–ü—Ä–∏–º–µ—Ä:** "üí¨ –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ - –û—Ç–≤–µ—Ç –Ω–∞ –≤–∞—à –∑–∞–ø—Ä–æ—Å..."
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:** –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º —á–∞—Ç–µ (chat presence detection)

#### 5.2 –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ –æ–ø–ª–∞—Ç–µ
```typescript
NotificationTypes.PAYMENT_CHAT_MESSAGE = 'payment_chat_message'
```
**–ö–æ–≥–¥–∞:** –ë—É—Ö–≥–∞–ª—Ç–µ—Ä –æ—Ç–ø—Ä–∞–≤–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç –ø–æ –æ–ø–ª–∞—Ç–µ
**–ü—Ä–∏–º–µ—Ä:** "üí∞ –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ –æ–ø–ª–∞—Ç–µ - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞..."

### 6. –ù–æ–≤–æ—Å—Ç–∏ (News)

#### 6.1 –ù–æ–≤–∞—è –Ω–æ–≤–æ—Å—Ç—å
```typescript
NotificationTypes.NEWS_CREATED = 'news_created'
```
**–ö–æ–≥–¥–∞:** –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –æ–ø—É–±–ª–∏–∫–æ–≤–∞–ª –Ω–æ–≤—É—é –Ω–æ–≤–æ—Å—Ç—å
**–ü—Ä–∏–º–µ—Ä:** "üì∞ –ù–æ–≤–∞—è –Ω–æ–≤–æ—Å—Ç—å - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–æ–≤ —Å 1 —Ñ–µ–≤—Ä–∞–ª—è"

### 7. –ü—Ä–∞–≤–∏–ª–∞ —Å–µ—Ä–≤–∏—Å–∞ (Service Rules)

#### 7.1 –ù–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞
```typescript
NotificationTypes.SERVICE_RULE_CREATED = 'service_rule_created'
```
**–ö–æ–≥–¥–∞:** –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –æ–ø—É–±–ª–∏–∫–æ–≤–∞–ª –Ω–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –æ–∫–∞–∑–∞–Ω–∏—è —É—Å–ª—É–≥
**–ü—Ä–∏–º–µ—Ä:** "üìã –ù–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ - –û–±–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª–∞ –æ–∫–∞–∑–∞–Ω–∏—è —É—Å–ª—É–≥"

---

## –¢–∏–ø—ã –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

### 1. –ß–∞—Ç—ã –æ—Ç –ö–ª–∏–µ–Ω—Ç–æ–≤

#### 1.1 –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ support chat
```typescript
type: 'chat_message'
```
**–ö–æ–≥–¥–∞:** –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏
**–ü—Ä–∏–º–µ—Ä:** "üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤ - –ö–æ–≥–¥–∞ –ø—Ä–∏–±—É–¥–µ—Ç –º–æ–π —Ç—Ä–µ–∫?"
**–§–∏–ª—å—Ç—Ä:** –¢–æ–ª—å–∫–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —Ç–æ–≥–æ –∂–µ agentId —á—Ç–æ –∏ –∫–ª–∏–µ–Ω—Ç

#### 1.2 –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ payment chat
```typescript
type: 'payment_chat_message'
```
**–ö–æ–≥–¥–∞:** –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç –ø–æ –æ–ø–ª–∞—Ç–µ
**–ü—Ä–∏–º–µ—Ä:** "üí∞ –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ –æ–ø–ª–∞—Ç–µ –æ—Ç –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤ - –û–ø–ª–∞—Ç–∏–ª —Å—á–µ—Ç..."

### 2. –ó–∞–ø—Ä–æ—Å—ã –§–æ—Ç–æ

```typescript
NotificationTypes.PHOTO_REQUEST_CREATED = 'photo_request_created'
```
**–ö–æ–≥–¥–∞:** –ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–ª –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç–∞
**–ü—Ä–∏–º–µ—Ä:** "üì∏ –ó–∞–ø—Ä–æ—Å —Ñ–æ—Ç–æ–æ—Ç—á—ë—Ç–∞ - –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–∏–ª —Ñ–æ—Ç–æ–æ—Ç—á—ë—Ç –¥–ª—è —Ç—Ä–µ–∫–∞ ABC123"
**–ö–æ–º—É:** –í—Å–µ–º –∞–∫—Ç–∏–≤–Ω—ã–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º –∞–≥–µ–Ω—Ç–∞

### 3. –í–æ–ø—Ä–æ—Å—ã –ø–æ –¢—Ä–µ–∫–∞–º

```typescript
NotificationTypes.QUESTION_CREATED = 'question_created'
```
**–ö–æ–≥–¥–∞:** –ö–ª–∏–µ–Ω—Ç –∑–∞–¥–∞–ª –≤–æ–ø—Ä–æ—Å –ø–æ —Ç—Ä–µ–∫—É
**–ü—Ä–∏–º–µ—Ä:** "üí¨ –ù–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å - –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤ –∑–∞–¥–∞–ª –≤–æ–ø—Ä–æ—Å –ø–æ —Ç—Ä–µ–∫—É ABC123"
**–ö–æ–º—É:** –í—Å–µ–º –∞–∫—Ç–∏–≤–Ω—ã–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º –∞–≥–µ–Ω—Ç–∞

### 4. –°–±–æ—Ä–∫–∏ (Assemblies)

#### 4.1 –ù–æ–≤–∞—è —Å–±–æ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ –∫–ª–∏–µ–Ω—Ç–æ–º
```typescript
NotificationTypes.ASSEMBLY_CREATED = 'assembly_created'
```
**–ö–æ–≥–¥–∞:** –ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–ª –Ω–æ–≤—É—é —Å–±–æ—Ä–∫—É
**–ü—Ä–∏–º–µ—Ä:** "üì¶ –ù–æ–≤–∞—è —Å–±–æ—Ä–∫–∞ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ - –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤ —Å–æ–∑–¥–∞–ª —Å–±–æ—Ä–∫—É SB-2025-0001 (3 —Ç—Ä–µ–∫–∞)"
**–ö–æ–º—É:** –í—Å–µ–º –∞–∫—Ç–∏–≤–Ω—ã–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º –∞–≥–µ–Ω—Ç–∞

#### 4.2 –¢—Ä–µ–∫ –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Å–±–æ—Ä–∫—É
```typescript
NotificationTypes.TRACK_ADDED_TO_ASSEMBLY = 'track_added_to_assembly'
```
**–ö–æ–≥–¥–∞:** –ö–ª–∏–µ–Ω—Ç –¥–æ–±–∞–≤–∏–ª —Ç—Ä–µ–∫ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–±–æ—Ä–∫—É
**–ü—Ä–∏–º–µ—Ä:** "üì¶ –¢—Ä–µ–∫ –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Å–±–æ—Ä–∫—É - –¢—Ä–µ–∫ ABC123 –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Å–±–æ—Ä–∫—É SB-2025-0001"
**–ö–æ–º—É:** –í—Å–µ–º –∞–∫—Ç–∏–≤–Ω—ã–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º –∞–≥–µ–Ω—Ç–∞

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ü–ª–∞—Ç—Ñ–æ—Ä–º

### iOS

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- Xcode 14+
- Apple Developer Account —Å Push Notification capability
- APNs Auth Key –∑–∞–≥—Ä—É–∂–µ–Ω –≤ Firebase Console

**–§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
- `ios/Runner/GoogleService-Info.plist` - Firebase config
- `firebase_options.dart` - Firebase options –¥–ª—è iOS

**Permissions:** –ó–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ

### Android

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- Android SDK 21+ (Lollipop)
- Firebase Cloud Messaging –≤–∫–ª—é—á–µ–Ω

**–§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
- `android/app/google-services.json` - Firebase config
- `firebase_options.dart` - Firebase options –¥–ª—è Android

**Notification Channels:**
- `track_status_channel` - –°—Ç–∞—Ç—É—Å—ã —Ç—Ä–µ–∫–æ–≤
- `assembly_status_channel` - –°—Ç–∞—Ç—É—Å—ã —Å–±–æ—Ä–æ–∫
- `photo_report_channel` - –§–æ—Ç–æ–æ—Ç—á—ë—Ç—ã
- `question_channel` - –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã
- `chat_channel` - –ß–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- `payment_chat_channel` - –ß–∞—Ç –ø–æ –æ–ø–ª–∞—Ç–µ
- `news_channel` - –ù–æ–≤–æ—Å—Ç–∏
- `service_rules_channel` - –ü—Ä–∞–≤–∏–ª–∞ –æ–∫–∞–∑–∞–Ω–∏—è —É—Å–ª—É–≥
- `invoice_channel` - –°—á–µ—Ç–∞

### Web

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- HTTPS (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è Service Workers)
- VAPID Key –¥–ª—è Web Push

**Service Worker:** `/web/firebase-messaging-sw.js`

**–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤ `/web/index.html`

**VAPID Key:**
```
BN84z0kGwWRFRalLMJ-HlMPVYBp5Tu7QnsGiACoT-ODg7VkwtFV_kdDhFHapsr5BguDgeBs0E6Pe2aY2_0fMshQ
```

**–ë—Ä–∞—É–∑–µ—Ä—ã:**
- ‚úÖ Chrome 50+
- ‚úÖ Firefox 44+
- ‚úÖ Safari 16+ (macOS Ventura+)
- ‚úÖ Edge 79+

### macOS

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- macOS 10.14+
- App Sandbox capability –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**Permissions:** –ó–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `flutter_local_notifications`

### Windows

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- Windows 10+
- Windows Toast Notifications

**–ü–ª–∞–≥–∏–Ω:** `flutter_local_notifications` v19.5.0+

---

## –ö–æ–¥ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ main.dart

```dart
Future<void> main() async {
  WidgetsFlutterBinding.ensureInitialized();

  // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å Firebase (–≤–∫–ª—é—á–∞—è FCM)
  await PushNotificationService.initializeFirebase();

  final prefs = await SharedPreferences.getInstance();

  runApp(
    ProviderScope(
      overrides: [
        sharedPreferencesProvider.overrideWithValue(prefs),
      ],
      child: const App(),
    ),
  );
}
```

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ App Widget

```dart
class _AppState extends ConsumerState<App> {
  @override
  void initState() {
    super.initState();
    _initializePushNotifications();
  }

  Future<void> _initializePushNotifications() async {
    final pushService = ref.read(pushNotificationServiceProvider);

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    await pushService.initialize(
      onTap: (route) {
        if (route != null) {
          // Navigate to route
          router.go(route);
        }
      },
    );

    // –ü–æ–ª—É—á–∏—Ç—å FCM —Ç–æ–∫–µ–Ω
    final token = await PushNotificationService.getFCMToken();
    if (token != null) {
      debugPrint('FCM Token: $token');
      // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä
      await _registerDeviceToken(token);
    }

    // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å callback –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
    PushNotificationService.onFCMMessageReceived = (message) {
      // –û–±—Ä–∞–±–æ—Ç–∞—Ç—å FCM —Å–æ–æ–±—â–µ–Ω–∏–µ
      _handleFCMMessage(message);
    };
  }
}
```

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Device Token –Ω–∞ –°–µ—Ä–≤–µ—Ä–µ

```dart
Future<void> _registerDeviceToken(String token) async {
  final apiClient = ref.read(apiClientProvider);

  await apiClient.post('/device-tokens', data: {
    'token': token,
    'platform': _getPlatformName(),
    'deviceName': await _getDeviceName(),
    'appVersion': await _getAppVersion(),
  });
}

String _getPlatformName() {
  if (kIsWeb) return 'web';
  if (Platform.isAndroid) return 'android';
  if (Platform.isIOS) return 'ios';
  if (Platform.isMacOS) return 'macos';
  if (Platform.isWindows) return 'windows';
  if (Platform.isLinux) return 'linux';
  return 'unknown';
}
```

### –ü–æ–∫–∞–∑ –õ–æ–∫–∞–ª—å–Ω–æ–≥–æ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

```dart
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ FCM
PushNotificationService.onFCMMessageReceived = (message) {
  // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
};

// –í—Ä—É—á–Ω—É—é –∏–∑ NotificationItem
final notificationService = ref.read(pushNotificationServiceProvider);
await notificationService.showNotification(notificationItem);
```

---

## Backend API

### –û—Ç–ø—Ä–∞–≤–∫–∞ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ö–ª–∏–µ–Ω—Ç—É

```typescript
import { createClientNotification } from '@/lib/notifications';

// –í API endpoint –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Ç—Ä–µ–∫–∞
await createClientNotification(
  clientId,
  'track_status_changed',
  'üì¶ –°—Ç–∞—Ç—É—Å —Ç—Ä–µ–∫–∞ –∏–∑–º–µ–Ω—ë–Ω',
  `–¢—Ä–µ–∫ ${trackNumber} –∏–∑–º–µ–Ω–∏–ª —Å—Ç–∞—Ç—É—Å –Ω–∞ "${newStatus}"`,
  {
    trackId: track.id.toString(),
    trackNumber: track.trackNumber,
    status: newStatus,
  }
);
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –í—Å–µ–º –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º –ê–≥–µ–Ω—Ç–∞

```typescript
import { createAllEmployeesNotification } from '@/lib/notifications';

// –í API endpoint –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ —Ñ–æ—Ç–æ
await createAllEmployeesNotification(
  agentId,
  'photo_request_created',
  'üì∏ –ó–∞–ø—Ä–æ—Å —Ñ–æ—Ç–æ–æ—Ç—á—ë—Ç–∞',
  `${clientName} –∑–∞–ø—Ä–æ—Å–∏–ª —Ñ–æ—Ç–æ–æ—Ç—á—ë—Ç –¥–ª—è —Ç—Ä–µ–∫–∞ ${trackNumber}`,
  {
    photoRequestId: photoRequest.id.toString(),
    trackId: track.id.toString(),
    clientId: client.id.toString(),
  }
);
```

### Chat Presence Detection

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∞–∫—Ç–∏–≤–Ω–æ–º —á–∞—Ç–µ:

```typescript
import { isClientInChat } from '@/lib/chat-presence';

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
const isInChat = await isClientInChat(clientId);
if (isInChat) {
  console.log('Skipping push - client is in active chat');
  return { success: true, pushSkipped: true };
}
```

---

## Database Schema

### Notification Table
```prisma
model Notification {
  id            Int      @id @default(autoincrement())
  agentId       Int?
  recipientType ChatParticipantType  // client | employee
  recipientId   Int
  type          String   // track_created, invoice_paid, etc.
  title         String
  body          String
  data          Json?    // Additional data for handling
  isRead        Boolean  @default(false)
  isPushed      Boolean  @default(false)  // Track if push was sent
  createdAt     DateTime @default(now())
  readAt        DateTime?

  pushDeliveries PushDelivery[]
}
```

### DeviceToken Table
```prisma
model DeviceToken {
  id                    Int      @id @default(autoincrement())
  ownerType             ChatParticipantType  // client | employee
  ownerId               Int
  platform              DevicePlatform  // ios, android, web, macos, windows, linux
  token                 String   // FCM/APNs/Web Push token
  deviceId              String?  // For deduplication
  deviceName            String?  // "iPhone 15", "Chrome Windows"
  notificationsEnabled  Boolean  @default(true)
  isActive              Boolean  @default(true)
  lastActiveAt          DateTime?

  // Web Push specific fields
  endpoint              String?  // Web Push endpoint URL
  p256dh                String?  // Web Push public key
  auth                  String?  // Web Push auth secret

  @@unique([ownerType, ownerId, token])
}
```

### PushDelivery Table
```prisma
model PushDelivery {
  id               Int      @id @default(autoincrement())
  notificationId   Int
  deviceTokenId    Int
  status           PushStatus  // pending, sent, delivered, failed
  errorMessage     String?
  createdAt        DateTime @default(now())
  sentAt           DateTime?
  deliveredAt      DateTime?

  notification     Notification @relation(fields: [notificationId], references: [id])
  deviceToken      DeviceToken  @relation(fields: [deviceTokenId], references: [id])

  @@unique([notificationId, deviceTokenId])
}
```

---

## –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ FCM Token

```dart
final token = await PushNotificationService.getFCMToken();
debugPrint('FCM Token: $token');
```

### –¢–µ—Å—Ç –õ–æ–∫–∞–ª—å–Ω–æ–≥–æ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

```dart
final pushService = ref.read(pushNotificationServiceProvider);

await pushService.showChatMessageNotification(
  senderName: '–¢–µ—Å—Ç',
  message: '–¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ',
);
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Service Worker (Web)

1. –û—Ç–∫—Ä—ã—Ç—å DevTools (F12)
2. –ü–µ—Ä–µ–π—Ç–∏ –≤ Application ‚Üí Service Workers
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `firebase-messaging-sw.js` –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
4. –ü–µ—Ä–µ–π—Ç–∏ –≤ Console
5. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ª–æ–≥: "Firebase Messaging SW registered: ..."

### –õ–æ–≥–∏ Backend

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
grep "notification" /var/log/app.log

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å FCM –æ—Ç–ø—Ä–∞–≤–∫—É
grep "FCM" /var/log/app.log
```

---

## Troubleshooting

### iOS: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Push Notifications capability –≤–∫–ª—é—á–µ–Ω –≤ Xcode
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ APNs Auth Key –∑–∞–≥—Ä—É–∂–µ–Ω –≤ Firebase Console
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Bundle ID —Å–æ–≤–ø–∞–¥–∞–µ—Ç
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ app –∑–∞–ø—É—â–µ–Ω –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ (–Ω–µ simulator)

### Android: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `google-services.json` –∞–∫—Ç—É–∞–ª–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å notification permissions –≤–∫–ª—é—á–µ–Ω—ã –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ battery optimization –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### Web: Service Worker –Ω–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–∞–π—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ HTTPS
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—É—Ç—å –∫ service worker —Ñ–∞–π–ª—É
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Console –¥–ª—è –æ—à–∏–±–æ–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
4. Hard refresh —Å—Ç—Ä–∞–Ω–∏—Ü—ã (Ctrl+Shift+R)

### macOS: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Notification permissions –≤ System Settings
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ App Sandbox –≤–∫–ª—é—á–µ–Ω
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### Token –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ç–µ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (token –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å endpoint `/device-tokens` —Ä–∞–±–æ—Ç–∞–µ—Ç
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞

---

## –õ—É—á—à–∏–µ –ü—Ä–∞–∫—Ç–∏–∫–∏

### 1. –ù–µ —Å–ø–∞–º–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏

- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ö–æ–∂–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω notification ID –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- –£–≤–∞–∂–∞—Ç—å —á–∞—Å–æ–≤—ã–µ –ø–æ—è—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 2. –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞/—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
- –£–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç—Ä–µ–∫–∏/—Å—á–µ—Ç–∞
- –î–æ–±–∞–≤–ª—è—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ç–∞—Ç—É—Å)

### 3. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏

- –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã
- –ü–æ–≤—Ç–æ—Ä—è—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö

- iOS –∏ Android —Ä–µ–≥—É–ª—è—Ä–Ω–æ
- Web –≤ —Ä–∞–∑–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö
- Desktop –Ω–∞ Windows –∏ macOS

### 5. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏

- Delivery rate (% –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö)
- Open rate (% –æ—Ç–∫—Ä—ã—Ç—ã—Ö)
- Token expiration rate
- Error rate –ø–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º

---

## –ú–µ—Ç—Ä–∏–∫–∏ –∏ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞

### –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ –°–æ–±—ã—Ç–∏—è

1. **Token Registration** - –∫–æ–≥–¥–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç FCM —Ç–æ–∫–µ–Ω
2. **Notification Created** - –∫–æ–≥–¥–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ –≤ –ë–î
3. **Notification Sent** - –∫–æ–≥–¥–∞ push –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ FCM
4. **Notification Delivered** - –∫–æ–≥–¥–∞ FCM –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –¥–æ—Å—Ç–∞–≤–∫—É
5. **Notification Opened** - –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
6. **Notification Failed** - –∫–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å

### Dashboard –ú–µ—Ç—Ä–∏–∫–∏

```sql
-- Delivery Rate –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
SELECT
  DATE(created_at) as date,
  COUNT(*) as total,
  SUM(CASE WHEN status = 'delivered' THEN 1 ELSE 0 END) as delivered,
  ROUND(100.0 * SUM(CASE WHEN status = 'delivered' THEN 1 ELSE 0 END) / COUNT(*), 2) as delivery_rate
FROM push_delivery
WHERE created_at >= NOW() - INTERVAL '7 days'
GROUP BY DATE(created_at)
ORDER BY date DESC;
```

---

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¢–æ–∫–µ–Ω–æ–≤

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

FCM —Ç–æ–∫–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è Firebase SDK. –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞:

```dart
FirebaseMessaging.instance.onTokenRefresh.listen((newToken) {
  debugPrint('FCM Token refreshed: $newToken');
  // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä
  _registerDeviceToken(newToken);
});
```

### –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –°—Ç–∞—Ä—ã—Ö –¢–æ–∫–µ–Ω–æ–≤

Backend –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö:

```typescript
// –í notifications.ts
if (response.failureCount > 0) {
  for (const error of response.responses) {
    if (error.error?.code === 'messaging/invalid-registration-token') {
      // –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω
      await prisma.deviceToken.update({
        where: { token: invalidToken },
        data: { isActive: false },
      });
    }
  }
}
```

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –ü–æ–¥–¥–µ—Ä–∂–∫–∏

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç—Ç—É –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
- –°–æ–∑–¥–∞—Ç—å issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 21 —è–Ω–≤–∞—Ä—è 2026
**–ê–≤—Ç–æ—Ä:** Claude Sonnet 4.5 + –ö–æ–º–∞–Ω–¥–∞ 2A Logistic
